<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" href="http://ol3js.org/en/master/css/ol.css"
	type="text/css">
<style>
html,body {
	height: 100%;
	width: 100%;
	margin: 0;
	overflow: hidden;
	font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}

#map {
	width: 100%;
	height: 100%;
}
</style>
<!-- <script src="http://localhost:8080/vkviewer/static/new/lib/ol-whitespace.js"></script> -->
<script src="http://sdvtypo3-3.slub-dresden.de/ol/ol-whitespace.js"></script>
</head>
<body>
	<div id="map"></div>
	<script type="text/javascript">
var map = new ol.Map({
    layers: [
        new ol.layer.Tile({
            source: new ol.source.OSM()
        })
    ],
    renderer: 'canvas',
    target:'map',
    view: new ol.View2D({
        projection: 'EPSG:900913',
        center: [1531627.8847864927, 6632124.286850829],
        zoom: 12 
    })
});
		
// add tiled wms layer
var tileLayer = new ol.layer.Tile({
	source: new ol.source.TileWMS({
		'url': 'http://194.95.145.43/mapcache',
		'params': {
			'LAYERS':'messtischblaetter',
			'TIME': '1925',
			'VERSION': '1.1.1'
		}, 
		'projection': 'EPSG:900913'
	})
});
		
// add clipping
var clipPolygon = [[1521174.692018,6621076.134534], [1521174.279003, 6638782.006083],
       [1539724.922617, 6638782.444995], [1539725.34154, 6621076.571889], [1521174.692018,6621076.134534]];
tileLayer.on('precompose', function(event){
		var canvas = event.context;
		
		// get clip pixel
		var clip_pixel = [];
		for (var i = 0, ii = clipPolygon.length; i < ii; i++){
			clip_pixel.push(map.getPixelFromCoordinate(clipPolygon[i]));
		};
		canvas.save();
		
		console.log('------------------------------------------');
		for (var i = 0, ii = clip_pixel.length; i < ii; i++ ){
			console.log(clip_pixel[i]);
		};
		console.log('------------------------------------------');
		
		// draw clip polygon on canvas
		canvas.beginPath();
		canvas.moveTo(clip_pixel[0][0],clip_pixel[0][1]);
		for (var i = 1, ii = clip_pixel.length; i < ii; i++){
			canvas.lineTo(clip_pixel[i][0],clip_pixel[i][1]);
		};
		canvas.closePath();
		
		
		canvas.clip();
});

tileLayer.on('postcompose', function(event){
	var canvas = event.context;
	canvas.restore();
});

map.addLayer(tileLayer);

</script>

</body>
</html>

